<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Jadwal Shift - Vertical View</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            /* M3 Dark Blue Palette */
            --md-sys-color-primary: #a8c7ff;
            --md-sys-color-on-primary: #002f68;
            --md-sys-color-primary-container: #004694;
            --md-sys-color-on-primary-container: #d6e3ff;
            --md-sys-color-surface: #1a1c1e;
            --md-sys-color-surface-container: #222427;
            --md-sys-color-on-surface: #e2e2e6;
            --md-sys-color-on-surface-variant: #c3c6cf;
            --md-sys-color-outline: #8d9199;
            --md-sys-color-icon-bg: #004694;
        }

        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            margin: 0;
            padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom) 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            width: 100%;
            overflow: hidden;
        }

        .app-container {
            width: 100%;
            max-width: 400px;
            margin: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
        }

        /* Vertical Carousel Styles */
        .content-wrapper {
            display: flex;
            align-items: center;
            width: 100%;
            justify-content: center;
            gap: 16px;
        }

        .carousel-viewport {
            width: 80%;
            height: 280px; /* Fixed height for vertical slide */
            overflow: hidden;
            position: relative;
            border-radius: 32px;
            background-color: var(--md-sys-color-surface-container);
            border: 1px solid rgba(168, 199, 255, 0.08);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .carousel-track {
            display: flex;
            flex-direction: column; /* Vertical direction */
            height: 100%;
            transition: transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .slide-card {
            min-height: 100%; /* Take full height of viewport */
            width: 100%;
            padding: 40px 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        /* Animated Icon */
        .icon-large {
            width: 72px;
            height: 72px;
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            background-color: var(--md-sys-color-icon-bg);
            color: var(--md-sys-color-primary); 
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform: scale(0.8);
            opacity: 0.3;
        }

        .slide-card.active .icon-large {
            transform: scale(1);
            opacity: 1;
        }

        .slide-card.active svg {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }

        .staff-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--md-sys-color-on-surface);
            letter-spacing: -0.01em;
            transform: translateY(10px);
            opacity: 0;
            transition: all 0.6s ease 0.2s;
        }

        .slide-card.active .staff-name {
            transform: translateY(0);
            opacity: 1;
        }

        .shift-label {
            text-transform: uppercase;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.3em;
            color: var(--md-sys-color-primary);
            opacity: 0.5;
            margin-bottom: 8px;
        }

        /* Vertical Indicator Dots */
        .indicators {
            display: flex;
            flex-direction: column; /* Stack dots vertically */
            gap: 10px;
        }

        .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--md-sys-color-outline);
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            opacity: 0.3;
        }

        .dot.active {
            height: 20px; /* Expand vertically instead of horizontally */
            border-radius: 10px;
            background: var(--md-sys-color-primary);
            opacity: 1;
        }

        .loading-spinner {
            border: 3px solid rgba(168, 199, 255, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: var(--md-sys-color-primary);
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        header {
            animation: fadeInDown 0.8s ease-out;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <div class="app-container">
        <!-- Header Section -->
        <header class="mb-8 w-full text-center">
            <p id="display-day-name" class="text-3xl font-bold text-[#a8c7ff] uppercase tracking-[0.2em] mb-1">MEMUAT</p>
            <h1 id="display-date-full" class="text-[12px] font-medium text-white/30 tracking-[0.25em] uppercase">-- --- ----</h1>
        </header>

        <!-- Dynamic Content -->
        <div id="loader" class="py-16 flex flex-col items-center">
            <div class="loading-spinner"></div>
            <p class="mt-6 text-[11px] font-medium tracking-[0.3em] text-[#a8c7ff]/40 uppercase">Sinkronisasi Data</p>
        </div>

        <div id="main-content" class="hidden w-full">
            <div class="content-wrapper">
                <div class="carousel-viewport">
                    <div class="carousel-track" id="carousel-track">
                        <!-- Shift Pagi -->
                        <div class="slide-card active" data-index="0">
                            <div class="icon-large">
                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="M20 12h2"/><path d="m19.07 4.93-1.41 1.41"/><path d="M15.947 12.65a4 4 0 0 0-5.925 4.128"/><path d="M13 22H4a2 2 0 0 1-2-2v-3a.5.5 0 0 1 .5-.5h2.472a2 2 0 0 0 1.789-1.105l.984-1.968A2 2 0 0 1 8.634 12.33a8.5 8.5 0 0 1 15.19 1.171 2 2 0 0 1-1.378 2.5l-2.071.492a2 2 0 0 0-1.428 1.428l-.492 2.07a2 2 0 0 1-2.5 1.379 2 2 0 0 1-1.17-1.17l-.786-1.571Z"/></svg>
                            </div>
                            <p class="shift-label">Shift Pagi</p>
                            <h2 id="pagi-val" class="staff-name">--</h2>
                        </div>

                        <!-- Shift Siang -->
                        <div class="slide-card" data-index="1">
                            <div class="icon-large">
                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
                            </div>
                            <p class="shift-label">Shift Siang</p>
                            <h2 id="siang-val" class="staff-name">--</h2>
                        </div>

                        <!-- Shift Malam -->
                        <div class="slide-card" data-index="2">
                            <div class="icon-large">
                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
                            </div>
                            <p class="shift-label">Shift Malam</p>
                            <h2 id="malam-val" class="staff-name">--</h2>
                        </div>

                        <!-- Off -->
                        <div class="slide-card" data-index="3">
                            <div class="icon-large">
                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                            </div>
                            <p class="shift-label">Off / Libur</p>
                            <h2 id="off-val" class="staff-name">--</h2>
                        </div>
                    </div>
                </div>

                <!-- Vertical Indicators -->
                <div class="indicators" id="indicators">
                    <div class="dot active"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTtl3aDMYAvHX3ig2FDyZrXQ8AijzZAAjvm-5bImSqT5qhh5SDrxVMQK4e5LR7piQn6tOzXy5IFhV37/pub?output=csv';
        let currentSelectedDate = new Date();
        let currentSlide = 0;
        let slideInterval;

        function parseCSV(text) {
            const rows = [];
            let row = [];
            let col = '';
            let inQuotes = false;
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                if (char === '"' && inQuotes && text[i+1] === '"') { col += '"'; i++; }
                else if (char === '"') inQuotes = !inQuotes;
                else if (char === ',' && !inQuotes) { row.push(col.trim()); col = ''; }
                else if (char === '\n' && !inQuotes) { row.push(col.trim()); rows.push(row); row = []; col = ''; }
                else col += char;
            }
            if (col || row.length > 0) { row.push(col.trim()); rows.push(row); }
            return rows;
        }

        async function fetchData() {
            const loader = document.getElementById('loader');
            const mainContent = document.getElementById('main-content');
            
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            
            document.getElementById('display-day-name').textContent = days[currentSelectedDate.getDay()];
            document.getElementById('display-date-full').textContent = `${currentSelectedDate.getDate()} ${months[currentSelectedDate.getMonth()]} ${currentSelectedDate.getFullYear()}`;
            
            const pattern = `${String(currentSelectedDate.getDate()).padStart(2, '0')}-${String(currentSelectedDate.getMonth() + 1).padStart(2, '0')}-${currentSelectedDate.getFullYear()}`;

            try {
                const res = await fetch(`${CSV_URL}&v=${Date.now()}`);
                const text = await res.text();
                const rows = parseCSV(text);
                const match = rows.find(r => r[1] && r[1].trim().includes(pattern));

                if (match) {
                    document.getElementById('pagi-val').textContent = match[2] || '-';
                    document.getElementById('siang-val').textContent = match[3] || '-';
                    document.getElementById('malam-val').textContent = match[4] || '-';
                    document.getElementById('off-val').textContent = match[5] || '-';
                    
                    loader.classList.add('hidden');
                    mainContent.classList.remove('hidden');
                    startAutoSlide();
                } else {
                    loader.innerHTML = `<p class="text-red-400 font-medium px-4 text-center text-xs">Jadwal tidak ditemukan</p>`;
                }
            } catch (e) {
                loader.innerHTML = `<p class="text-red-400 font-medium text-xs">Gagal sinkronisasi</p>`;
            }
        }

        function startAutoSlide() {
            clearInterval(slideInterval);
            slideInterval = setInterval(() => {
                currentSlide = (currentSlide + 1) % 4;
                updateSlide();
            }, 3500);
        }

        function updateSlide() {
            const track = document.getElementById('carousel-track');
            const dots = document.querySelectorAll('.dot');
            const slides = document.querySelectorAll('.slide-card');
            
            // Vertical translation using translateY
            if (track) track.style.transform = `translateY(-${currentSlide * 100}%)`;
            
            dots.forEach((dot, i) => dot.classList.toggle('active', i === currentSlide));
            slides.forEach((slide, i) => slide.classList.toggle('active', i === currentSlide));
        }

        // Vertical Swipe Logic
        let touchStartY = 0;
        let touchEndY = 0;
        const viewport = document.querySelector('.carousel-viewport');
        
        viewport.addEventListener('touchstart', e => {
            touchStartY = e.changedTouches[0].screenY;
            clearInterval(slideInterval);
        }, {passive: true});
        
        viewport.addEventListener('touchend', e => {
            touchEndY = e.changedTouches[0].screenY;
            const diff = touchStartY - touchEndY;
            if (Math.abs(diff) > 40) {
                if (diff > 0) {
                    currentSlide = (currentSlide + 1) % 4;
                } else {
                    currentSlide = (currentSlide - 1 + 4) % 4;
                }
                updateSlide();
            }
            setTimeout(startAutoSlide, 5000);
        }, {passive: true});

        window.onload = fetchData;
    </script>
</body>
</html>

